<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="external_layout_background_payment">
        <div class="header">
            <div>ESTE DOCUMENTO ES UNA REPRESENTACION IMPRESA DE UN CFDI:</div>
            <div>EMISOR:<span t-field="o.company_id.name"/></div>
        </div>
        <div class="article">
            <t t-raw="0" />
        </div>

        <div class="footer">
            <div class="text-center">
                <ul class="list-inline">
                    <li t-if="company.phone"><i class="fa fa-phone"/> <span t-field="company.phone"/></li>
                    <li t-if="company.email"><i class="fa fa-at"/> <span t-field="company.email"/></li>
                    <li t-if="company.website"><i class="fa fa-globe"/> <span t-field="company.website"/></li>
                    <li t-if="company.vat"><i class="fa fa-building-o"/><t t-esc="company.country_id.vat_label or 'TIN'"/>: <span t-field="company.vat"/></li>
                </ul>
                <div t-field="company.report_footer"/>
                <div class="text-muted">
                    Page:
                    <span class="page"/>
                    of
                    <span class="topage"/>
                </div>
            </div>
        </div>
    </template>

    <template id="external_layout_payment">
        <!-- Multicompany -->
        <t t-if="not o and doc">
            <t t-set="o" t-value="doc"/>
        </t>
        <t t-if="o and 'company_id' in o">
            <t t-set="company" t-value="o.company_id.sudo()"/>
        </t>
        <t t-if="not o or not 'company_id' in o">
            <t t-set="company" t-value="res_company"/>
        </t>
        <t t-call="l10n_mx_payment_cfdi.external_layout_background_payment"><t t-raw="0"/></t>
    </template>

        <template id="report_payment_document">
            <t t-call="l10n_mx_payment_cfdi.external_layout_payment">
                <t t-set="o" t-value="o.with_context({'lang':o.partner_id.lang})" />
                <div class="page">
                    <div class="oe_structure"/>
                    <div class="row">
                        <hr width="100%" size="1"/>
                        <table align="left" style="font-size:13px;width: 100%;">
                            <tr >     
                                <td align="left" width="30%" style="vertical-align: top;">
                                    <center>
                                        <img t-if="o.company_id.logo" t-att-src="'data:image/png;base64,%s' % to_text(o.company_id.logo)" height="100" width="140"/>
                                    </center>
                                </td>
                                <td align="center" width="40%" style="text-align: center; vertical-align: top;">
                                    <b><span t-esc="o.company_id.name"/></b>
                                    <br/><b> <span t-esc="o.company_id.partner_id.vat_split"/></b>

                                    <br/><span t-esc="o.company_id.partner_id.street"/>
                                    No. Ext:<span t-esc="o.company_id.partner_id.street_number"/> 
                                    No. Int:<span t-esc="o.company_id.partner_id.street_number2"/>
                                    <br/>Col:<span t-esc="o.company_id.partner_id.street2"/>
                                    C.P.:<span t-esc="o.company_id.partner_id.zip"/>
                                </td>
                                <td align="left" width="30%" style="text-align: center; vertical-align: top;">
                                    <table width="100%" style="border:1px solid #ddd;">
                                        <tr bgcolor="#C0C0C0" align="center">
                                            <td colspan="2">RECIBO DE PAGO:</td>
                                        </tr>
                                        <tr bgcolor="#C0C0C0" align="center">
                                            <td>Serie y Folio:</td>
                                            <td>Fecha y Hora:</td>
                                        </tr>
                                        <tr align="center">
                                            <td><span t-esc="o.number_cfdi"/></td>
                                            <td><span t-esc="o.cfdi_fecha_timbrado"/></td>
                                        </tr>

                                    </table>
                                </td>
                            </tr>
                        </table>
                        <hr width="100%" size="1"/>
                        <table width="100%">
                            <tr>
                                <th align="left" style="border-top:1px solid grey;border-left:1px solid grey;border-bottom:1px solid grey;">
                                    <b><font style="font-size:11px">
                                        <b>Cliente:<span t-esc="o.partner_id.name"/></b><br/>
                                        <b>Direccion:<span t-esc="o.partner_id.street"/> <span t-esc="o.partner_id.street2"/>
                                        <span t-esc="o.partner_id.street2"/></b><br/>

                                        <b>Ciudad: <span t-esc="o.partner_id.city"/></b><br/>
                                        <b>C.P: <span t-esc="o.partner_id.zip"/></b><br/>                            
                                        </font>
                                    </b>
                                </th>
                                <th align="left" 
                                style="border-top:1px solid grey;border-right:1px solid grey;border-bottom:1px solid grey;" valign="bottom">
                                    <b><font style="font-size:11px">
                                         <b>Col:<span t-esc="o.partner_id.street2"/></b><br/> 
                                        <b>RFC:<span t-esc="o.partner_id.vat_split"/></b><br/>                            
                                        </font>
                                    </b>
                                </th>
                                <th style="border:1px solid grey;vertical-align: middle;" width="30%">
                                    <b><font style="font-size:11px">
                                        <b>No.Certificado: <span t-esc="o.no_certificado"/></b><br/>
                                    </font></b>
                                </th>
                            </tr>
                        </table>
                         <hr width="100%" size="1"/>
                        <table width="100%" class="basic_table" rules="cols" style="border:1.5px solid grey;font-size:11px;" border="2" cellpadding="2" cellspacing="2"  bordercolorlight="#C0C0C0">
                            <thead>
                                <tr>
                                    <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
                                        <b><font style="font-size:11px">
                                            Codigo
                                        </font>
                                        </b>
                                    </th>
                                    <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
                                        <b><font style="font-size:11px">
                                            Cantidad
                                        </font>
                                        </b>
                                    </th>
                                    <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
                                        <b><font style="font-size:11px">
                                            Moneda
                                        </font>
                                        </b>
                                    </th>
                                    <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
                                        <b><font style="font-size:11px">
                                            Descripcion
                                        </font>
                                        </b>
                                    </th>
                                    <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
                                        <b><font style="font-size:11px">
                                            Unidad de Medida
                                        </font>
                                        </b>
                                    </th>
                                    <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
                                        <b><font style="font-size:11px">
                                            Precio Unitario
                                        </font>
                                        </b>
                                    </th>
                                    <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
                                        <b><font style="font-size:11px">
                                            Importe
                                        </font>
                                        </b>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><font style="font-size:11px">84111506</font></td>
                                    <td><font style="font-size:11px">1</font></td>
                                    <td><font style="font-size:11px"><span t-esc="o.currency_id.name"/></font></td>
                                    <td><font style="font-size:11px">Pago</font></td>
                                    <td><font style="font-size:11px">ACT</font></td>
                                    <td><font style="font-size:11px">$ 0.00</font></td>
                                    <td><font style="font-size:11px">$ 0.00</font></td>
                                </tr>
                            </tbody>
                        </table>
                        <br/>
                        CFDI Relacionados
                        <table width="100%" class="basic_table" rules="cols" style="border:1.5px solid grey;" border="2" cellpadding="2" cellspacing="2"  bordercolorlight="#C0C0C0">
                        	<thead >
		                        <tr>
		                            <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
		                                <b><font style="font-size:11px">
		                                    UUID
		                                </font>
		                                </b>
		                            </th>
		                            <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
		                                <b><font style="font-size:11px">
		                                    Folio
		                                </font>
		                                </b>
		                            </th>
		                            
		                            <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
		                                <b><font style="font-size:11px">
		                                    Metodo
		                                </font>
		                                </b>
		                            </th>
		                            <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
		                                <b><font style="font-size:11px">
		                                    Total
		                                </font>
		                                </b>
		                            </th>
		                            <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
		                                <b><font style="font-size:11px">
		                                    Saldo Anterior
		                                </font>
		                                </b>
		                            </th>
		                            <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
		                                <b><font style="font-size:11px">
		                                    Saldo Pendiente
		                                </font>
		                                </b>
		                            </th>
		                            <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
		                                <b><font style="font-size:11px">
		                                    Monto Pagado
		                                </font>
		                                </b>
		                            </th>
		                        </tr>
		                    </thead>
		                    <tbody>
		                    	<tr  t-foreach="get_payment_lines" t-as="item" style="font-size:11px;">

                                    <t t-if="o.journal_id.currency_id and o.journal_id.currency_id.id==item.debit_move_id.invoice_id.currency_id.id">
    		                    		<td><span t-field="item.debit_move_id.invoice_id.cfdi_folio_fiscal"/></td>
    		                    		<td><span t-field="item.debit_move_id.invoice_id.number"/></td>
    		                    		<td><span t-esc="item.debit_move_id.invoice_id.payment_method"/></td>
    		                    		<td><span t-field="item.debit_move_id.invoice_id.amount_total"/></td>
    		                    		<td><span t-esc="item.amount_residual_currency+item.amount_currency"/></td>
    		                    		<td><span t-esc="item.amount_residual_currency"/></td>
    		                    		<td><span t-esc="item.amount_currency"/></td>
                                    </t>

                                    <t t-elif="o.journal_id.currency_id and o.journal_id.currency_id.id!=o.company_id.currency_id.id and o.journal_id.currency_id.id!=item.debit_move_id.invoice_id.currency_id.id">
                                        <td><span t-field="item.debit_move_id.invoice_id.cfdi_folio_fiscal"/></td>
                                        <td><span t-field="item.debit_move_id.invoice_id.number"/></td>
                                        <td><span t-esc="item.debit_move_id.invoice_id.payment_method"/></td>
                                        <td><span t-field="item.debit_move_id.invoice_id.amount_total"/></td>
                                        <td><span t-esc="item.amount_residual+item.amount"/></td>
                                        <td><span t-esc="item.amount_residual"/></td>
                                        <td><span t-esc="item.amount"/></td>
                                    </t>

                                    <t t-elif="o.journal_id.currency_id and item.debit_move_id.invoice_id.currency_id.id!=o.company_id.currency_id.id">
                                        <td><span t-field="item.debit_move_id.invoice_id.cfdi_folio_fiscal"/></td>
                                        <td><span t-field="item.debit_move_id.invoice_id.number"/></td>
                                        <td><span t-esc="item.debit_move_id.invoice_id.payment_method"/></td>
                                        <td><span t-field="item.debit_move_id.invoice_id.amount_total"/></td>
                                        <td><span t-esc="item.amount_residual_currency+item.amount_currency"/></td>
                                        <td><span t-esc="item.amount_residual_currency"/></td>
                                        <td><span t-esc="item.amount_currency"/></td>
                                    </t>

                                    <t t-else="">
                                        <td><span t-field="item.debit_move_id.invoice_id.cfdi_folio_fiscal"/></td>
                                        <td><span t-field="item.debit_move_id.invoice_id.number"/></td>
                                        <td><span t-esc="item.debit_move_id.invoice_id.payment_method"/></td>
                                        <td><span t-field="item.debit_move_id.invoice_id.amount_total"/></td>
                                        <td><span t-esc="item.amount+item.amount_residual"/></td>
                                        <td><span t-esc="item.amount_residual"/></td>
                                        <td><span t-esc="item.amount"/></td>
                                    </t>
		                    	</tr>
		                    </tbody>
                            
                        </table>
                        <br/>
                        <table width="100%" class="basic_table" rules="cols" style="border:1.5px solid grey;" border="2" cellpadding="2" cellspacing="2"  bordercolorlight="#C0C0C0">
                            <thead>
                                <tr>
                                    <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
                                        <b><font style="font-size:11px">
                                            Fecha y hora de Pagos
                                        </font>
                                        </b>
                                    </th>
                                    <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
                                        <b><font style="font-size:11px">
                                            Forma de Pago
                                        </font>
                                        </b>
                                    </th>
                                    <th style="border-bottom: 1px solid #666" align="center" bgcolor="#C0C0C0">
                                        <b><font style="font-size:11px">
                                            Total del Pago
                                        </font>
                                        </b>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><font style="font-size:11px"><span t-esc="o.payment_date"/></font></td>
                                    <td><font style="font-size:11px"><span t-esc="o.journal_id.payment_type_id.code"/></font></td>
                                    <td><font style="font-size:11px"><span t-esc="o.amount"/></font></td>
                                </tr>
                            </tbody>
                        </table>
                        <br/>
                        <table width="100%" class="basic_table" rules="cols" style="font-size:11px;border:1px solid grey;" border="2" cellpadding="2" cellspacing="2"  bordercolorlight="#C0C0C0">
                            <tr style="border-bottom: 1px solid #666">
                                <td rowspan="4"  width="15%" align="center">
                                    <img t-if="o.cfdi_qrcode" t-att-src="'data:image/png;base64,%s' % to_text(o.cfdi_qrcode)" height="199" width="199"/>
                                </td>
                                <td width="10%">Cadena Original:</td>
                                <td>
                                    <!-- Cadena Original:<br/> -->
                                    <span t-field="o.cfdi_cadena_original" style="display:block;width:600px;word-wrap:break-word;"/>                
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #666">
                                <td>Sello</td>
                               <!-- <td></td> -->
                                <td>
                                  <!--   Sello<br/> -->
                                    <span t-field="o.sello" style="display:block;width:600px;word-wrap:break-word;"/>
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #666">
                                <td>Sello SAT:</td>
                             <!--    <td></td> -->
                                <td >
                                   <!--  Sello SAT:<br/> -->
                                    <span t-field="o.cfdi_sello" style="display:block;width:600px;word-wrap:break-word;"/>

                                </td>
                                <br/>
                            </tr>
                        </table> 
                    </div>
                </div>
            </t>
        </template>

        <template id="report_payments">
            <t t-call="web.html_container">    
                <t t-foreach="docs" t-as="o">
                    <t t-call="l10n_mx_payment_cfdi.report_payment_document" t-lang="o.partner_id.lang" />
                </t>
            </t>
        </template>


</odoo>
